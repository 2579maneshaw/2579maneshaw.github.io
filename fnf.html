<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Friends & Family Booking Request | Enchanted Villa of WH</title>

  <!-- Keep this page out of search engines -->
  <meta name="robots" content="noindex,nofollow,noarchive,nosnippet" />

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin: 0; background: #f6f7f9; color: #111; }
    .wrap { max-width: 860px; margin: 0 auto; padding: 24px 16px 56px; }
    .card { background: #fff; border-radius: 14px; padding: 22px; box-shadow: 0 8px 24px rgba(0,0,0,.06); }
    h1 { margin: 0 0 8px; font-size: 1.6rem; }
    p { margin: 0 0 16px; line-height: 1.5; color: #333; }
    .grid { display: grid; gap: 14px; grid-template-columns: 1fr; }
    @media (min-width: 720px) { .grid.two { grid-template-columns: 1fr 1fr; } }
    label { font-weight: 600; font-size: .95rem; display: block; margin-bottom: 6px; }
    input, select, textarea {
      width: 100%; box-sizing: border-box;
      padding: 11px 12px; border-radius: 10px;
      border: 1px solid #cfd5dd; background: #fff;
      font-size: 1rem;
    }
    input:focus, textarea:focus, select:focus { outline: 3px solid rgba(0,0,0,.08); border-color: #9aa6b2; }
    .sectionTitle { margin-top: 18px; margin-bottom: 10px; font-weight: 800; }
    .choiceRow { display: flex; gap: 14px; flex-wrap: wrap; margin-bottom: 10px; }
    .choice {
      display: flex; align-items: center; gap: 8px;
      border: 1px solid #cfd5dd; padding: 10px 12px; border-radius: 10px;
      background: #fafbfc;
    }
    .choice input { width: auto; }
    .hint { font-size: .92rem; color: #555; margin-top: 6px; }
    .btnRow { display: flex; gap: 12px; align-items: center; margin-top: 18px; }
    button {
      border: 0; border-radius: 12px; padding: 12px 16px;
      background: #111; color: #fff; font-weight: 700;
      cursor: pointer; font-size: 1rem;
    }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .status { margin-top: 14px; font-size: .98rem; }
    .status.ok { color: #0a7a2f; }
    .status.err { color: #b00020; }
    .fineprint { margin-top: 14px; font-size: .9rem; color: #666; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Friends & Family Booking Request</h1>
      <p>
        Use this private form to request a friends and family rate. The daily rate will be set by the pricing model used to stay competitive, but removes the Property Management's booking fee.
    We’ll confirm availability and pricing by text or email.
      </p>

      <!--
        IMPORTANT:
        1) Create a Formspree form and paste your endpoint below.
        2) Configure recipients in Formspree to email infoevwh@gmail.com + your second email.
      -->
      <form id="ffForm" action="https://formspree.io/f/xgolrkoa" method="POST" novalidate>
        <!-- Subject line requirement -->
        <input type="hidden" name="_subject" value="Enchanted Villa of WH Booking request - Family/Friend" />

        <!-- This line will appear in the emailed submission body -->
        <input type="hidden" name="Instructions to Property Manager"
          value='If you receive this email, the owner has tentatively verified and approved a direct booking, for friends and family, without the 20% booking fee. All other fees should still apply to the guest. Please contact the guest below to continue the booking process (less 20% fee).' />
        <input type="hidden" name="Instructions to Owner"
          value='Jayla or Derek, once you agree with the guest on dates/pricing, forward this email to your property manager to book without the 20% booking fee, but cleaning fee and all other fees still apply.' />

        <div class="grid two">
          <div>
             <input type="hidden" name="Guest Information"
            <label for="firstName">First name</label>
            <input id="firstName" name="First name" type="text" required autocomplete="given-name" />
          </div>
          <div>
            <label for="lastName">Last name</label>
            <input id="lastName" name="Last name" type="text" required autocomplete="family-name" />
          </div>
        </div>

        <div class="grid two">
          <div>
            <label for="cell">Cell number (for texting)</label>
            <input id="cell" name="Cell" type="tel" required autocomplete="tel"
                   placeholder="(###) ###-####" />
          </div>
          <div>
            <label for="email">Email</label>
            <input id="email" name="Email" type="email" required autocomplete="email" />
          </div>
        </div>

        <!-- NEW: Relationship dropdown -->
        <div class="sectionTitle">How do you know the owner?</div>
        <div class="grid">
          <div>
            <label for="relationship">Select one</label>
            <select id="relationship" name="How do you know the owner?" required>
              <option value="" selected disabled>Select...</option>
              <option value="I am Family">I am Family</option>
              <option value="I am a Friend">I am a Friend</option>
              <option value="The owner directed me to this page">The owner directed me to this page</option>
            </select>
            <div class="hint">This helps us confirm eligibility for friends and family booking.</div>
          </div>
        </div>

        <!-- NEW: Required long text field when "owner directed me" is selected -->
        <div id="directedDetailBlock" style="display:none; margin-top:14px;">
          <label for="directedDetails">Please provide more detail about your relationship to the owner</label>
          <textarea id="directedDetails"
                    name="Relationship details"
                    rows="5"
                    placeholder="Example: coworker, neighbor, friend of the family, how you were referred, etc."></textarea>
          <div class="hint">Required only if you selected “The owner directed me to this page.”</div>
        </div>

        <div class="sectionTitle">Dates</div>
        <div class="choiceRow" role="radiogroup" aria-label="Date selection type">
          <label class="choice">
            <input type="radio" name="Date preference" value="Exact start/end dates" id="modeExact" required />
            Exact start and end dates
          </label>
          <label class="choice">
            <input type="radio" name="Date preference" value="Flexible range + number of days" id="modeFlex" required />
            Flexible range and number of days
          </label>
        </div>

        <!-- Exact dates -->
        <div id="exactBlock" style="display:none;">
          <div class="grid two">
            <div>
              <label for="startDate">Start date</label>
              <input id="startDate" name="Start date" type="date" />
            </div>
            <div>
              <label for="endDate">End date</label>
              <input id="endDate" name="End date" type="date" />
            </div>
          </div>
          <div class="hint">Choose the exact dates you want to travel.</div>
        </div>

        <!-- Flexible range -->
        <div id="flexBlock" style="display:none;">
          <div class="grid two">
            <div>
              <label for="rangeStart">Earliest start date</label>
              <input id="rangeStart" name="Range start date" type="date" />
            </div>
            <div>
              <label for="rangeEnd">Latest end date</label>
              <input id="rangeEnd" name="Range end date" type="date" />
            </div>
          </div>

          <div class="grid two" style="margin-top:14px;">
            <div>
              <label for="nights">Number of nights</label>
              <input id="nights" name="Number of nights" type="number" min="1" step="1" />
            </div>
            <div>
              <label for="flexNotes">Any notes (optional)</label>
              <input id="flexNotes" name="Notes" type="text" placeholder="Example: prefer weekend, okay midweek, etc." />
            </div>
          </div>
          <div class="hint">Pick a date range you’re open to and how many nights you want to stay.</div>
        </div>

        <div class="btnRow">
          <button id="submitBtn" type="submit">Send request</button>
        </div>

        <div id="status" class="status" aria-live="polite"></div>

        <div class="fineprint">
          This private page is intended for friends and family only. If we do not recognize you this request will be denied.
        </div>
      </form>
    </div>
  </div>

  <script>
    (function () {
      const form = document.getElementById('ffForm');
      const status = document.getElementById('status');
      const submitBtn = document.getElementById('submitBtn');

      const modeExact = document.getElementById('modeExact');
      const modeFlex  = document.getElementById('modeFlex');

      const exactBlock = document.getElementById('exactBlock');
      const flexBlock  = document.getElementById('flexBlock');

      const startDate = document.getElementById('startDate');
      const endDate   = document.getElementById('endDate');

      const rangeStart = document.getElementById('rangeStart');
      const rangeEnd   = document.getElementById('rangeEnd');
      const nights     = document.getElementById('nights');

      // NEW: relationship dropdown + conditional details
      const relationship = document.getElementById('relationship');
      const directedDetailBlock = document.getElementById('directedDetailBlock');
      const directedDetails = document.getElementById('directedDetails');

      function setRequired(el, isReq) {
        if (isReq) el.setAttribute('required', 'required');
        else el.removeAttribute('required');
      }

      function toggleMode() {
        const exact = modeExact.checked;
        const flex  = modeFlex.checked;

        exactBlock.style.display = exact ? '' : 'none';
        flexBlock.style.display  = flex ? '' : 'none';

        // Either/or requirement
        setRequired(startDate, exact);
        setRequired(endDate, exact);

        setRequired(rangeStart, flex);
        setRequired(rangeEnd, flex);
        setRequired(nights, flex);
      }

      // NEW: show required long text field when needed
      function toggleRelationshipDetails() {
        const isDirected = relationship.value === 'The owner directed me to this page';
        directedDetailBlock.style.display = isDirected ? '' : 'none';
        setRequired(directedDetails, isDirected);
        if (!isDirected) directedDetails.value = '';
      }

      modeExact.addEventListener('change', toggleMode);
      modeFlex.addEventListener('change', toggleMode);

      relationship.addEventListener('change', toggleRelationshipDetails);

      // Ensure initial state is correct
      toggleMode();
      toggleRelationshipDetails();

      // Handle submit with fetch so guests get a clean confirmation message
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        status.textContent = '';
        status.className = 'status';

        // Trigger browser validation messages
        if (!form.checkValidity()) {
          form.reportValidity();
          return;
        }

        // Extra sanity check: end date after start date when exact mode
        if (modeExact.checked) {
          const s = startDate.value;
          const en = endDate.value;
          if (s && en && en < s) {
            status.textContent = 'End date must be on or after the start date.';
            status.className = 'status err';
            return;
          }
        }

        submitBtn.disabled = true;
        try {
          const formData = new FormData(form);
          const resp = await fetch(form.action, {
            method: 'POST',
            body: formData,
            headers: { 'Accept': 'application/json' }
          });

          if (resp.ok) {
            status.textContent = 'Request sent. We will reach out soon by text or email.';
            status.className = 'status ok';
            form.reset();
            toggleMode();
            toggleRelationshipDetails();
          } else {
            const data = await resp.json().catch(() => ({}));
            status.textContent = data?.error || 'Something went wrong sending your request. Please try again.';
            status.className = 'status err';
          }
        } catch (err) {
          status.textContent = 'Network error. Please try again.';
          status.className = 'status err';
        } finally {
          submitBtn.disabled = false;
        }
      });
    })();
  </script>
</body>
</html>
